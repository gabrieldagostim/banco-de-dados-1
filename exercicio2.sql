-- Exercício de Linguagem SQL 2--Para responder os exercícios abaixo utilize o padrão de Linguagem do SGBD Microsoft SQL Server.--Utilize o SSMS (SQL Server Management Studio) para conexão ao banco de dados SQL Server.--1. Qual é a média da nota em matemática dos alunos que estudaram numa escola em Santa Catarina?SELECT TOP 10	SG_UF_ESC AS uf,	NO_MUNICIPIO_PROVA AS municipio,	avg(NU_NOTA_MT) AS media_mat_sc FROM MICRODADOS_ENEM_2022_SC meWHERE SG_UF_ESC = 'SC'GROUP BY SG_UF_ESC, NO_MUNICIPIO_PROVAORDER BY avg(NU_NOTA_MT) desc --2. Qual é a média da nota em Linguagens e Códigos dos alunos que estudaram numa escola em Santa--Catarina?SELECT NU_NOTA_LC,* FROM MICRODADOS_ENEM_2022_SC meSELECT	SG_UF_ESC AS uf,	avg(NU_NOTA_LC) AS nota_ling_cod_scFROM MICRODADOS_ENEM_2022_SC meWHERE SG_UF_ESC = 'SC'--3. Qual é a média da nota em Ciências Humanas dos alunos do sexo FEMININO que estudaram numa--escola em Santa Catarina?SELECTavg(NU_NOTA_CH) AS notas_femininas_ciencias_humanasFROM MICRODADOS_ENEM_2022_SC meWHERETP_SEXO = 'F' AND CO_MUNICIPIO_ESC = 4202909--4. Qual é a média da nota em Matemática dos alunos do sexo FEMININO que estudaram numa escola--na cidade de Criciúma?SELECT avg(NU_NOTA_MT) AS media_mat_cri FROM MICRODADOS_ENEM_2022_SC meWHERE TP_SEXO = 'F' AND NO_MUNICIPIO_ESC = 'Criciúma'--5. Qual é a diferença da nota média em matemática dos alunos que estudaram o ensino médio em--escola pública e em escola privada?SELECT	AVG(CASE WHEN TP_DEPENDENCIA_ADM_ESC IN (1,2,3) THEN NU_NOTA_MT END) AS media_publica,	AVG(CASE WHEN TP_DEPENDENCIA_ADM_ESC = 4 THEN NU_NOTA_MT END) AS media_privada,	AVG(CASE WHEN TP_DEPENDENCIA_ADM_ESC = 4 THEN NU_NOTA_MT END) 		- AVG(CASE WHEN TP_DEPENDENCIA_ADM_ESC IN (1,2,3) THEN NU_NOTA_MT END) AS diferencaFROM MICRODADOS_ENEM_2022_SC;--6. Quantos alunos não quiseram declarar a cor/raça em 2022 em SC (Entenda a opção "não--declarado" nessa pergunta)?SELECTcount(distinct NU_INSCRICAO) as alunos_sem_corFROM MICRODADOS_ENEM_2022_SCWHERE nu_ano = 2022 and SG_UF_ESC = 'SC' and TP_COR_RACA = 0--7. Qual é o número de alunos do sexo feminino que estudaram em escola no estado de Santa--Catarina?SELECTCOUNT(DISTINCT NU_INSCRICAO) AS alunos_fema_scFROM MICRODADOS_ENEM_2022_SCWHERE SG_UF_ESC = 'SC' AND TP_SEXO = 'F'--8. Quantos alunos do sexo masculino que estudaram em escola no estado de Santa Catarina possuem--EXATAMENTE uma geladeira em casa?SELECTCOUNT(DISTINCT NU_INSCRICAO) AS alunos_masc_com_geladeiraFROM MICRODADOS_ENEM_2022_SCWHERE SG_UF_ESC = 'SC' AND TP_SEXO = 'M' AND Q012 = 'B'--9. Quantos alunos que estudaram em escolas em zona rural de Santa Catarina possuem internet em--casa?SELECT	COUNT(DISTINCT NU_INSCRICAO) as alunos_c_net_zona_rualFROM	MICRODADOS_ENEM_2022_SCWHERE	TP_LOCALIZACAO_ESC = 2AND	Q025 = 'B'--10. Quantos alunos cuja residência possui ATÉ 2 carros estudaram na região Amurel (buscar a--informação de quais municípios fazem parte da região Amurel)?SELECT 	COUNT(DISTINCT NU_INSCRICAO) AS qtd_alu_c_2_carro_amurelFROM	MICRODADOS_ENEM_2022_SCWHERE	Q010 IN ('A','B','C')AND	NO_MUNICIPIO_ESC IN ('Armazém','Braço do Norte','Capivari de Baixo','Grão-Pará','Gravatal','Imaruí','Imbituba','Jaguaruna','Laguna','Pedras Grandes','Pescaria Brava', 'Rio Fortuna', 'Sangão','Santa Rosa de Lima','São Ludgero','São Martinho','Treze de Maio','Tubarão')--11. Qual é a segunda cidade catarinense (considere a coluna NO_MUNICIPIO_ESC) em que estudaram--mais alunos no ENEM 2020? (GROUP BY)SELECT TOP 2	NO_MUNICIPIO_ESC, COUNT(DISTINCT NU_INSCRICAO)FROM	MICRODADOS_ENEM_2022_SCWHERE	NU_ANO = 2022GROUP BY 	NO_MUNICIPIO_ESCORDER BY	COUNT(DISTINCT NU_INSCRICAO) DESC --12. Qual é a cidade catarinense (considere a coluna NO_MUNICIPIO_ESC) possui o menor número de--alunos cuja mãe possui ensino superior completo? (GROUP BY)SELECT TOP 1	NO_MUNICIPIO_ESC as municipio,	COUNT(DISTINCT NU_INSCRICAO) as qtd_com_superior_completoFROM	MICRODADOS_ENEM_2022_SCWHERE	NU_ANO = 2022 AND	Q002 IN ('F','G') AND	SG_UF_ESC = 'SC'GROUP BY 	NO_MUNICIPIO_ESCORDER BY	COUNT(DISTINCT NU_INSCRICAO) ASC --13. Qual é a segunda cidade catarinense (considere a coluna NO_MUNICIPIO_ESC) que possui o maior--número de pessoas na faixa “entre 26 e 30 anos”? (GROUP BY)SELECT 	TOP 2	NO_MUNICIPIO_ESC AS MUNICIPIO,	COUNT(NU_INSCRICAO) AS IDADE_26_A_30_ANOSFROM	MICRODADOS_ENEM_2022_SCWHERE	TP_FAIXA_ETARIA = 11GROUP BY NO_MUNICIPIO_ESCORDER BY COUNT(NU_INSCRICAO) DESC--14. Qual é a cidade catarinense (considere a coluna NO_MUNICIPIO_ESC) que possui o TERCEIRO--maior número de alunos cuja residência possui PELO MENOS 2 banheiros? (GROUP BY)SELECT	TOP 3	NO_MUNICIPIO_ESC AS MUNICIPIO, 	COUNT(NU_INSCRICAO) AS QTD_ALUNOSFROM MICRODADOS_ENEM_2022_SCWHERE	Q009 IN ('C', 'D', 'E')GROUP BY	NO_MUNICIPIO_ESCHAVING	COUNT(NU_INSCRICAO) BETWEEN 4000 AND 5000ORDER BY	COUNT(NU_INSCRICAO) DESC--|------------------------------------------------------------------------------------------------------------|--|----------------------------------------- Questoes cabeludas  ----------------------------------------------|--|------------------------------------------------------------------------------------------------------------|--Questão 15: Ranking dos Melhores Municípios por Estado em Matemática (Escolas Públicas)--Enunciado: Crie uma consulta que identifique os 3 municípios com a maior média de nota em Matemática (NU_NOTA_MT) dentro de cada estado (SG_UF_PROVA). Considere apenas os alunos de escolas públicas (TP_ESCOLA = 2).-- A consulta final deve exibir o estado, o nome do município, a média de matemática calculada e a posição (ranking) desse município dentro do seu respectivo estado.-- Dicas de conceitos a serem usados:-- Você precisará organizar a lógica em etapas. Uma Common Table Expression (CTE) com a cláusula WITH é perfeita para isso.-- Primeiro, você terá que calcular a média por município. Pense em como usar GROUP BY.-- O desafio principal é criar um ranking que "reinicia" para cada estado. Uma simples ORDER BY não resolve. Pesquise sobre Funções de Janela (Window Functions), especificamente RANK() ou DENSE_RANK() com a cláusula PARTITION BY.-- usando cteWITH MediasPorMunicipio AS (	SELECT		SG_UF_ESC AS estado,		NO_MUNICIPIO_ESC AS municipio,		AVG(CAST(NU_NOTA_MT AS FLOAT)) AS media_mat	FROM MICRODADOS_ENEM_2022_SC	WHERE		TP_ESCOLA = 2 AND NU_NOTA_MT IS NOT NULL	GROUP BY		SG_UF_ESC, NO_MUNICIPIO_ESC),RankDosMunicipios AS (	SELECT		*,		RANK() OVER (PARTITION BY estado order by media_mat desc) as ranking	FROM		MediasPorMunicipio	)SELECT	*FROM	RankDosMunicipiosWHERE	ranking <= 3;go--Questão 16: Análise Comparativa de Desempenho por Renda Familiar--Enunciado: Compare o desempenho médio em cada uma das 5 competências (Ciências da Natureza, Ciências Humanas, Linguagens e Códigos, Matemática e Redação) entre dois grupos distintos:--Baixa Renda: Participantes com renda familiar Q006 igual a 'A' ou 'B'.--Alta Renda: Participantes com renda familiar Q006 igual a 'P' ou 'Q'.--A saída da sua consulta deve ter uma linha para cada competência e duas colunas de resultado: Media_Baixa_Renda e Media_Alta_Renda.--Dicas de conceitos a serem usados:--Este é um problema clássico de "pivotar" dados (transformar linhas em colunas).--A forma mais flexível de resolver isso é com Agregação Condicional. A ideia é usar uma função de agregação (como AVG) e, dentro dela, uma declaração CASE WHEN para especificar qual subgrupo de dados deve ser considerado para aquele cálculo.--Você provavelmente precisará de uma consulta para cada competência e depois juntar os resultados verticalmente com UNION ALL.WITH CienciasDanatureza AS (	SELECT		'Ciencias da natureza' AS campo,		AVG(CASE WHEN Q006 LIKE '[A-E]' THEN CAST(NU_NOTA_CN AS FLOAT) END) as nt_baixa_renda,		AVG(CASE WHEN Q006 LIKE '[F-L]' THEN CAST(NU_NOTA_CN AS FLOAT) END) as nt_media_renda,		AVG(CASE WHEN Q006 LIKE '[M-Q]' THEN CAST(NU_NOTA_CN AS FLOAT) END) as nt_alta_renda	FROM 		MICRODADOS_ENEM_2022_SC),CienciasHumanas AS (	SELECT 		'Ciencias Humanas' AS campo,		AVG(CASE WHEN Q006 LIKE '[A-E]' THEN CAST(NU_NOTA_CH AS FLOAT) END) as nt_baixa_renda,		AVG(CASE WHEN Q006 LIKE '[F-L]' THEN CAST(NU_NOTA_CH AS FLOAT) END) as nt_media_renda,		AVG(CASE WHEN Q006 LIKE '[M-Q]' THEN CAST(NU_NOTA_CH AS FLOAT) END) as nt_alta_renda	FROM 		MICRODADOS_ENEM_2022_SC),LinguagensECodigos AS (	SELECT 		'Linguagens e Codigos' AS campo,		AVG(CASE WHEN Q006 LIKE '[A-E]' THEN CAST(NU_NOTA_LC AS FLOAT) END) as nt_baixa_renda,		AVG(CASE WHEN Q006 LIKE '[F-L]' THEN CAST(NU_NOTA_LC AS FLOAT) END) as nt_media_renda,		AVG(CASE WHEN Q006 LIKE '[M-Q]' THEN CAST(NU_NOTA_LC AS FLOAT) END) as nt_alta_renda	FROM 		MICRODADOS_ENEM_2022_SC),Matematica AS (	SELECT 		'Matematica' AS campo,		AVG(CASE WHEN Q006 LIKE '[A-E]' THEN CAST(NU_NOTA_MT AS FLOAT) END) as nt_baixa_renda,		AVG(CASE WHEN Q006 LIKE '[F-L]' THEN CAST(NU_NOTA_MT AS FLOAT) END) as nt_media_renda,		AVG(CASE WHEN Q006 LIKE '[M-Q]' THEN CAST(NU_NOTA_MT AS FLOAT) END) as nt_alta_renda	FROM 		MICRODADOS_ENEM_2022_SC),Redacao AS (	SELECT 		'Redacao' AS campo,		AVG(CASE WHEN Q006 LIKE '[A-E]' THEN CAST(NU_NOTA_REDACAO AS FLOAT) END) as nt_baixa_renda,		AVG(CASE WHEN Q006 LIKE '[F-L]' THEN CAST(NU_NOTA_REDACAO AS FLOAT) END) as nt_media_renda,		AVG(CASE WHEN Q006 LIKE '[M-Q]' THEN CAST(NU_NOTA_REDACAO AS FLOAT) END) as nt_alta_renda	FROM 		MICRODADOS_ENEM_2022_SC)SELECT * FROM CienciasDanaturezaUNION ALLSELECT * FROM CienciasHumanasUNION ALLSELECT * FROM LinguagensECodigosUNION ALLSELECT * FROM MatematicaUNION ALLSELECT * FROM Redacao;--'Questão 17 (Nova Versão): Análise de Desempenho por Faixa Etária--Enunciado: Analise o desempenho médio geral por faixa etária (TP_FAIXA_ETARIA). A consulta deve exibir cada faixa etária, o número de participantes nela, e a média geral das notas (considerando as 5 competências) para aquele grupo.--O desafio aqui é muito parecido com o anterior. Antes de agruparmos por faixa etária, precisamos primeiro calcular a "Média Geral" para cada participante individualmente.--O problema é que um aluno pode ter notas nulas se faltou em alguma prova. Por exemplo, se um aluno fez apenas 4 das 5 provas, a média dele deve ser a soma das 4 notas, dividida por 4 (e não por 5).WITH QtdProvasFeitasAluno as (	SELECT		TP_FAIXA_ETARIA AS faixa_etaria,		CASE WHEN (		CASE WHEN NU_NOTA_CN IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_CH IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_LC IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_MT IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_REDACAO IS NOT NULL THEN 1 ELSE 0 END		) = 0 THEN 0 ELSE		(		CASE WHEN NU_NOTA_CN IS NULL THEN 0 ELSE NU_NOTA_CN END + 		CASE WHEN NU_NOTA_CH IS NULL THEN 0 ELSE NU_NOTA_CH END + 		CASE WHEN NU_NOTA_LC IS NULL THEN 0 ELSE NU_NOTA_LC END + 		CASE WHEN NU_NOTA_MT IS NULL THEN 0 ELSE NU_NOTA_MT END + 		CASE WHEN NU_NOTA_REDACAO IS NULL THEN 0 ELSE NU_NOTA_REDACAO END		) / 		(		CASE WHEN NU_NOTA_CN IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_CH IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_LC IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_MT IS NOT NULL THEN 1 ELSE 0 END + 		CASE WHEN NU_NOTA_REDACAO IS NOT NULL THEN 1 ELSE 0 END		) END AS MediaGeral	FROM		MICRODADOS_ENEM_2022_SC)SELECT	faixa_etaria,	avg(MediaGeral) as MediaGeral,	count(faixa_etaria) as NumParticipantesFROM	QtdProvasFeitasAlunoGROUP BY 	faixa_etariaORDER BY count(faixa_etaria) DESC